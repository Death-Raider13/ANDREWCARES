<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to Andrew Cares Village</title>
        <!-- Fonts and Icons -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link
            href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@400;500;700&display=swap"
            rel="stylesheet">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
            crossorigin="anonymous" referrerpolicy="no-referrer" />

        <style>
        :root {
            --background-color: #F4F2ED;
            --text-primary: #333333;
            --text-secondary: #555555;
            --color-primary: #B38B00;
            --color-secondary: #001F3F;
            --card-bg: #FFFFFF;
            --border-color: #EAEAEA;
            --hover-bg: #F9F9F9;
            --success-color: #2e7d32;
            --error-color: #d32f2f;
            --warning-color: #f57c00;
            --shadow-light: 0 4px 15px rgba(0, 0, 0, .05);
            --shadow-medium: 0 8px 25px rgba(0, 0, 0, .1);
            --shadow-dark: 0 8px 25px rgba(0, 0, 0, .15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Footer Styles */
        .main-footer {
            background-color: var(--card-bg);
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--border-color);
            border-bottom: none;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 3rem;
        }
        
        .footer-links a {
            margin: 0 1rem;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* Andrew Cares Logo Styles */
        .andrew-cares-logo {
            display: inline-flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
            transition: transform 0.3s ease;
        }

        .andrew-cares-logo:hover {
            transform: scale(1.05);
        }

        .andrew-cares-logo img {
            height: 80px;
            width: auto;
            max-width: 400px;
        }

        .header-logo img {
            height: 70px;
        }

        @media (max-width: 768px) {
            .andrew-cares-logo img {
                height: 60px;
            }
            
            .header-logo img {
                height: 55px;
            }
        }

        @media (max-width: 480px) {
            .andrew-cares-logo img {
                height: 50px;
            }
            
            .header-logo img {
                height: 45px;
            }
        }

        /* Header Styles */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-light);
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--color-secondary);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-actions button {
            padding: .8rem 1.5rem;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all .3s;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .header-actions button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .header-actions button:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary), #9c7a00);
            color: #fff;
            box-shadow: 0 4px 15px rgba(179, 139, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(179, 139, 0, 0.4);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background-color: var(--color-primary);
            color: #fff;
            transform: translateY(-2px);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 5rem 2rem;
            background-image:
                linear-gradient(135deg, rgba(0, 31, 63, 0.8), rgba(179, 139, 0, 0.6)),
                url(https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=2070&auto=format&fit=crop);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 20%, rgba(0, 31, 63, 0.3) 100%);
        }

        .hero-content {
            position: relative;
            z-index: 2;
            animation: fadeInUp 1s ease-out;
        }

        .hero h1 {
            font-family: 'Cinzel', serif;
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff, #f0c674);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            max-width: 700px;
            margin: 0 auto 2rem auto;
            opacity: 0.95;
        }

        /* Disciplines Section */
        .disciplines {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .discipline-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            transition: all .3s ease;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .discipline-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-primary), transparent);
            opacity: 0.05;
            transition: left 0.5s ease;
        }

        .discipline-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-medium);
            border-color: var(--color-primary);
        }

        .discipline-card:hover::before {
            left: 0;
        }

        .discipline-card i {
            font-size: 3rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            display: block;
            transition: transform 0.3s ease;
        }

        .discipline-card:hover i {
            transform: scale(1.1) rotate(5deg);
        }

        .discipline-card h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--color-secondary);
        }

        .discipline-card p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Membership Section */
        .membership-section {
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #fff, #f8f8f8);
        }

        .membership-section h2 {
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 4vw, 2.5rem);
            margin-bottom: 3rem;
            color: var(--color-secondary);
        }

        .membership-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .tier-card {
            border: 1px solid var(--border-color);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            transition: all .3s ease;
            background: var(--card-bg);
            position: relative;
            overflow: hidden;
        }

        .tier-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--color-primary), #f0c674);
            transition: all 0.5s ease;
            transform: translateX(-50%);
        }

        .tier-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-medium);
            border-color: var(--color-primary);
        }

        .tier-card:hover::after {
            width: 80%;
        }

        .tier-card h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
        }

        .tier-card .price {
            font-size: 2.5rem;
            font-weight: 700;
            margin: .5rem 0;
            color: var(--color-secondary);
        }

        .tier-card .price-term {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .tier-card ul {
            list-style: none;
            margin: 1.5rem 0;
            text-align: left;
            flex-grow: 1;
        }

        .tier-card li {
            margin-bottom: .8rem;
            display: flex;
            align-items: center;
            transition: transform 0.2s ease;
        }

        .tier-card li:hover {
            transform: translateX(5px);
        }

        .tier-card li i {
            margin-right: .7rem;
            width: 20px;
        }

        .tier-card li .fa-check {
            color: var(--success-color);
        }

        .tier-card li .fa-times {
            color: var(--error-color);
        }

        .tier-card .choose-plan-btn {
            margin-top: auto;
            padding: 1rem 2rem;
            border-radius: 25px;
            border: none;
            background: linear-gradient(135deg, var(--color-primary), #9c7a00);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tier-card .choose-plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(179, 139, 0, 0.4);
        }

        /* Founder Tier Special Styling */
        .tier-card.founder {
            background: linear-gradient(135deg, var(--color-secondary), #002a5c);
            color: #fff;
            border: 2px solid var(--color-primary);
            position: relative;
            overflow: hidden;
        }

        .tier-card.founder::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(179, 139, 0, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        .tier-card.founder h3,
        .tier-card.founder .price,
        .tier-card.founder .fa-crown {
            color: var(--color-primary);
        }

        .tier-card.founder .price-term {
            color: #ccc;
        }

        .tier-card.founder .founder-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, var(--color-primary), #f0c674);
            color: var(--color-secondary);
            padding: .5rem 1.5rem;
            font-family: 'Cinzel', serif;
            font-size: .9rem;
            font-weight: 700;
            border-bottom-left-radius: 15px;
            z-index: 10;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, .7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.visible {
            display: flex;
            opacity: 1;
        }

        .modal-container {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: var(--shadow-dark);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.visible .modal-container {
            transform: scale(1);
        }

        .close-modal-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal-btn:hover {
            background-color: var(--hover-bg);
            color: var(--error-color);
        }

        .modal-container h2 {
            font-family: 'Cinzel', serif;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--color-secondary);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: .9rem;
            margin-bottom: .5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input {
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #fafafa;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(179, 139, 0, 0.1);
        }

        .modal-submit-btn {
            padding: 1rem;
            background: linear-gradient(135deg, var(--color-primary), #9c7a00);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .modal-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(179, 139, 0, 0.4);
        }

        .modal-submit-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        .modal-message {
            text-align: center;
            margin-top: 1rem;
            font-weight: 500;
            padding: 0.5rem;
            border-radius: 5px;
        }

        .modal-message.error {
            color: var(--error-color);
            background-color: rgba(211, 47, 47, 0.1);
        }

        .modal-message.success {
            color: var(--success-color);
            background-color: rgba(46, 125, 50, 0.1);
        }

        .modal-message.warning {
            color: var(--warning-color);
            background-color: rgba(245, 124, 0, 0.1);
        }

        .switch-modal {
            text-align: center;
            margin-top: 1.5rem;
            font-size: .9rem;
        }

        .switch-modal span {
            color: var(--color-primary);
            cursor: pointer;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .switch-modal span:hover {
            color: #9c7a00;
        }

        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--text-secondary);
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-color);
        }

        .divider:not(:empty)::before {
            margin-right: .75em;
        }

        .divider:not(:empty)::after {
            margin-left: .75em;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 1rem;
            background-color: #fff;
            color: #444;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .3s ease;
        }

        .google-btn:hover {
            background-color: var(--hover-bg);
            border-color: var(--color-primary);
        }

        .google-btn img {
            width: 20px;
            height: 20px;
        }

        /* Email Verification Notice */
        .verification-notice {
            background: linear-gradient(135deg, var(--warning-color), #ff9800);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1rem;
            display: none;
        }

        .verification-notice.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .verification-notice button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .verification-notice button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Toast Notification Styles */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 15px 20px;
            border-radius: 10px;
            color: #fff;
            font-weight: 500;
            box-shadow: var(--shadow-dark);
            transform: translateX(120%);
            opacity: 0;
            transition: all .5s ease;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success-color), #2e7d32);
        }

        .toast.error {
            background: linear-gradient(135deg, var(--error-color), #c62828);
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning-color), #ef6c00);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .hero {
                padding: 3rem 1rem;
                background-attachment: scroll;
            }

            .disciplines {
                padding: 2rem 1rem;
                grid-template-columns: 1fr;
            }

            .membership-section {
                padding: 2rem 1rem;
            }

            .membership-tiers {
                grid-template-columns: 1fr;
            }

            .modal-container {
                margin: 1rem;
                padding: 2rem;
            }
        }

        @media (max-width: 480px) {
            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .header-actions button {
                flex: 1;
                max-width: 150px;
            }
        }
    </style>
    </head>

    <body>
        <!-- Header -->
        <header class="main-header">
            <a href="index.html" class="andrew-cares-logo header-logo">
                <img src="images/andrew_cares_logo.png" alt="Andrew Cares Village Logo">
            </a>
            <div class="header-actions">
                <button onclick="window.location.href='login.html'"
                    class="btn-secondary">Login</button>
                <button onclick="window.location.href='signup.html'"
                    class="btn-primary">Join Now</button>
                <button onclick="window.location.href='contact.html'"
                    class="btn-primary">Support</button>
                <button onclick="window.location.href='About.html'"
                    class="btn-primary">Who we are</button>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <section class="hero">
                <div class="hero-content">
                    <h1>Master Yourself, Master Your Life</h1>
                    <p>Join a community dedicated to holistic growth through
                        discipline, finance, and fitness. Become the
                        strongest version of yourself, together.</p>
                    <button id="heroJoinBtn" class="btn-primary"
                        onclick="window.location.href='login.html?action=signup'">Start
                        Your Journey</button>
                </div>
            </section>

            <section class="disciplines">
                <div class="discipline-card">
                    <i class="fas fa-fist-raised"></i>
                    <h2>Karate</h2>
                    <p>Cultivate discipline, focus, and self-defense skills in
                        our digital dojo. Master the art of mind and
                        body unity.</p>
                </div>
                <div class="discipline-card">
                    <i class="fas fa-chart-line"></i>
                    <h2>Forex</h2>
                    <p>Learn the art of currency trading from seasoned experts.
                        Transform financial knowledge into lasting
                        wealth.</p>
                </div>
                <div class="discipline-card">
                    <i class="fas fa-dumbbell"></i>
                    <h2>Fitness</h2>
                    <p>Build a stronger, healthier body with our comprehensive
                        workout programs. Forge your physical
                        excellence.</p>
                </div>
            </section>
        </main>

        <!-- Toast Notification Container -->
        <div id="toastContainer"></div>

        <script type="module">
        // Firebase SDK Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, sendEmailVerification, reload, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAM8S_LtlBaqfp7WoU6xLdaEMIyW_cZHRc",
            authDomain: "andrew-cares-village-f4cb6.firebaseapp.com",
           projectId: "andrew-cares-village-f4cb6",      
            storageBucket: "andrew-cares-village-f4cb6.firebasestorage.app",
            messagingSenderId: "255087116955",
            appId: "1:255087116955:web:84360ee1f13888f9b83c3e"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const heroJoinBtn = document.getElementById('heroJoinBtn');
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const googleSignupBtn = document.getElementById('googleSignupBtn');
        const choosePlanBtns = document.querySelectorAll('.choose-plan-btn');
        const toastContainer = document.getElementById('toastContainer');
        
        // Verification elements
        const verificationNotice = document.getElementById('verificationNotice');
        const loginVerificationNotice = document.getElementById('loginVerificationNotice');
        const resendVerificationBtn = document.getElementById('resendVerificationBtn');
        const loginResendVerificationBtn = document.getElementById('loginResendVerificationBtn');

        // Global variables
        let pendingUser = null;

        // Toast Notification function
        const showToast = (message, type = 'error') => {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        };

        // Email verification functions
        const showVerificationNotice = (modal, user) => {
            const notice = modal === 'signup' ? verificationNotice : loginVerificationNotice;
            notice.classList.add('show');
            pendingUser = user;
        };

        const hideVerificationNotice = (modal) => {
            const notice = modal === 'signup' ? verificationNotice : loginVerificationNotice;
            notice.classList.remove('show');
        };

        const sendVerificationEmail = async (user) => {
            try {
                await sendEmailVerification(user);
                showToast("Verification email sent! Please check your inbox.", "success");
            } catch (error) {
                console.error("Error sending verification email:", error);
                showToast("Error sending verification email. Please try again.", "error");
            }
        };

        // Role and membership-based redirect logic
        const getRedirectUrl = (userData) => {
            // First check if email is verified
            if (!auth.currentUser?.emailVerified) {
                return null; // Stay on landing page
            }

            // Admin and Instructor roles go to admin/instructor dashboards
            if (userData.role === 'admin') {
                return 'admin.html';
            } else if (userData.role === 'instructor') {
                return 'instructor.html';
            }

            // Regular users based on membership status
            if (userData.membershipTier === 'none' || userData.membershipTier === 'pending') {
                return 'charter.html';
            } else {
                return 'home.html';
            }
        };

        // Auth State Observer with email verification and role-based routing
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const authAction = sessionStorage.getItem('authActionInProgress');
                
                // Reload user to get latest emailVerified status
                await reload(user);

                try {
                    const userRef = doc(db, "users", user.uid);
                    const userSnap = await getDoc(userRef);

                    if (userSnap.exists()) {
                        const userData = userSnap.data();

                        // Check if account is blocked
                        if (userData.isBlocked) {
                            showToast("Your account has been suspended.", "error");
                            await auth.signOut();
                            return;
                        }

                        // Check email verification status
                        if (!user.emailVerified) {
                            if (authAction !== 'login') {
                                showVerificationNotice('signup', user);
                            }
                            return; // Don't redirect if email not verified
                        }

                        // Email is verified, proceed with redirect
                        const redirectUrl = getRedirectUrl(userData);
                        if (redirectUrl && authAction !== 'login') {
                            sessionStorage.setItem('authActionInProgress', 'true');
                            setTimeout(() => {
                                window.location.href = redirectUrl;
                            }, 1000);
                        } else if (authAction === 'login') {
                            sessionStorage.removeItem('authActionInProgress');
                            const redirectUrl = getRedirectUrl(userData);
                            if (redirectUrl) {
                                setTimeout(() => {
                                    window.location.href = redirectUrl;
                                }, 1000);
                            }
                        }
                    } else {
                        showToast("User data not found. Please contact support.", "error");
                        await auth.signOut();
                    }
                } catch (error) {
                    console.error("Error checking user data:", error);
                    showToast("Error loading user data. Please try again.", "error");
                }
            } else {
                hideVerificationNotice('signup');
                hideVerificationNotice('login');
                pendingUser = null;
            }
        });

        // Modal Management
        const openModal = (modal) => {
            modal.classList.add('visible');
            document.body.style.overflow = 'hidden';
        };

        const closeModal = (modal) => {
            modal.classList.remove('visible');
            document.body.style.overflow = '';
            hideVerificationNotice('signup');
            hideVerificationNotice('login');
        };

        // Event Listeners
        loginBtn.addEventListener('click', () => openModal(loginModal));
        signupBtn.addEventListener('click', () => openModal(signupModal));
        heroJoinBtn.addEventListener('click', () => openModal(signupModal));
        choosePlanBtns.forEach(btn => btn.addEventListener('click', () => openModal(signupModal)));

        // Close modal handlers
        document.querySelectorAll('.close-modal-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                closeModal(e.target.closest('.modal-overlay'));
            });
        });

        // Modal switching
        document.getElementById('switchToLogin').addEventListener('click', () => {
            closeModal(signupModal);
            openModal(loginModal);
        });

        document.getElementById('switchToSignup').addEventListener('click', () => {
            closeModal(loginModal);
            openModal(signupModal);
        });

        // Close modal on overlay click
        [loginModal, signupModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal);
                }
            });
        });

        // Resend verification email handlers
        resendVerificationBtn.addEventListener('click', async () => {
            if (pendingUser) {
                await sendVerificationEmail(pendingUser);
            }
        });

        loginResendVerificationBtn.addEventListener('click', async () => {
            if (pendingUser) {
                await sendVerificationEmail(pendingUser);
            }
        });

        // Helper for showing messages in modals
        const showModalMessage = (element, message, isError = true) => {
            element.textContent = message;
            element.className = `modal-message ${isError ? 'error' : 'success'}`;
        };

        // Sign Up Logic with Email Verification
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const submitBtn = signupForm.querySelector('button[type="submit"]');
            const messageEl = document.getElementById('signupMessage');

            if (!name || !email || !password) {
                showModalMessage(messageEl, "All fields are required.");
                return;
            }

            if (password.length < 6) {
                showModalMessage(messageEl, "Password must be at least 6 characters.");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Account...';
            showModalMessage(messageEl, "", false);

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Send verification email
                await sendEmailVerification(user);

                // Create user document
                await createUserDocument(user, name);

                showToast("Account created! Please check your email for verification.", "success");
                showVerificationNotice('signup', user);

                // Reset form
                signupForm.reset();

            } catch (error) {
                console.error("Signup error:", error);
                let errorMessage = "Failed to create account. Please try again.";

                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = "This email is already registered. try logging in instead.";
                        break;
                    case 'auth/invalid-email':
                        errorMessage = "Please enter a valid email address.";
                        break;
                    case 'auth/weak-password':
                        errorMessage = "Password is too weak. Please choose a stronger password.";
                        break;
                }

                showModalMessage(messageEl, errorMessage);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Create Account';
            }
        });

        // Enhanced Login Logic with Rate Limiting and Better Error Handling
        const loginAttempts = new Map();
        const MAX_ATTEMPTS = 5;
        const LOCKOUT_TIME = 15 * 60 * 1000; // 15 minutes

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            const messageEl = document.getElementById('loginMessage');

            // Check rate limiting
            const userAttempts = loginAttempts.get(email) || { count: 0, timestamp: 0 };
            if (userAttempts.count >= MAX_ATTEMPTS) {
                const timeLeft = LOCKOUT_TIME - (Date.now() - userAttempts.timestamp);
                    if (timeLeft > 0) {
                        showModalMessage(messageEl, `Too many login attempts. Please try again in ${Math.ceil(timeLeft / 60000)} minutes.`);
                        return;
                    } else {
                        loginAttempts.delete(email);
                    }
                }

            if (!email || !password) {
                showModalMessage(messageEl, "Please enter both email and password.");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Signing In...';
            showModalMessage(messageEl, "", false);

            sessionStorage.setItem('authActionInProgress', 'login');

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Reload user to get latest verification status
                await reload(user);

                if (!user.emailVerified) {
                    showVerificationNotice('login', user);
                    showModalMessage(messageEl, "Please verify your email address before logging in.", true);
                    sessionStorage.removeItem('authActionInProgress');
                    return;
                }

                // Get user data to determine redirect
                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);

                if (userSnap.exists()) {
                    const userData = userSnap.data();

                    if (userData.isBlocked) {
                        showModalMessage(messageEl, "Your account has been suspended.");
                        await auth.signOut();
                        sessionStorage.removeItem('authActionInProgress');
                        return;
                    }

                    showToast("Welcome back!", "success");
                    closeModal(loginModal);

                    // Redirect based on role and membership
                    const redirectUrl = getRedirectUrl(userData);
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 1000);

                } else {
                    // User exists in Auth but not in Firestore - create a new user document
                    try {
                        showModalMessage(messageEl, "Setting up your account...", false);
                        
                        // Create user document with default values
                        await createUserDocument(user, user.displayName || email.split('@')[0]);
                        
                        showToast("Account setup complete!", "success");
                        closeModal(loginModal);
                        
                        // Redirect to charter page to select membership
                        setTimeout(() => {
                            window.location.href = 'charter.html';
                        }, 1000);
                    } catch (error) {
                        console.error("Error creating user document:", error);
                        showModalMessage(messageEl, "Error setting up your account. Please try again.");
                        await auth.signOut();
                        sessionStorage.removeItem('authActionInProgress');
                    }
                }

            } catch (error) {
                console.error("Login error:", error);
                sessionStorage.removeItem('authActionInProgress');

                let errorMessage = "Failed to sign in. Please try again.";

                switch (error.code) {
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        errorMessage = "Invalid email or password.";
                        break;
                    case 'auth/invalid-email':
                        errorMessage = "Please enter a valid email address.";
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = "Too many failed attempts. Please try again later.";
                        break;
                }

                showModalMessage(messageEl, errorMessage);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
            }
        });

        // Google Sign-In Logic with Email Verification
        const handleGoogleSignIn = async (isSignup = false) => {
            const messageEl = isSignup ?
                document.getElementById('signupMessage') :
                document.getElementById('loginMessage');

            try {
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;

                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);

                if (!userSnap.exists()) {
                    // New user - Google accounts are automatically verified
                    await createUserDocument(user, user.displayName, user.photoURL);
                    showToast("Account created successfully! Welcome to the village.", "success");
                    
                    setTimeout(() => {
                        window.location.href = 'charter.html';
                    }, 1000);
                } else {
                    // Existing user
                    const userData = userSnap.data();
                    
                    if (userData.isBlocked) {
                        showModalMessage(messageEl, "Your account has been suspended.");
                        await auth.signOut();
                        return;
                    }

                    showToast("Welcome back!", "success");
                    closeModal(isSignup ? signupModal : loginModal);
                    
                    const redirectUrl = getRedirectUrl(userData);
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 1000);
                }

            } catch (error) {
                console.error("Google Sign-In Error:", error);
                let errorMessage = "Could not sign in with Google. Please try again.";

                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = "Sign-in cancelled.";
                }

                showModalMessage(messageEl, errorMessage);
            }
        };

        googleSignupBtn.addEventListener('click', () => handleGoogleSignIn(true));
        googleLoginBtn.addEventListener('click', () => handleGoogleSignIn(false));

        // Create user document in Firestore with role-based defaults
        async function createUserDocument(user, name, avatarUrl = null) {
            const userRef = doc(db, "users", user.uid);
            const now = new Date().toISOString();
            
            await setDoc(userRef, {
                name: name || 'Anonymous User',
                email: user.email,
                uid: user.uid,
                membershipTier: 'apprentice', // Default to apprentice (free tier)
                role: 'member', // Default role, can be changed by admin
                isBlocked: false,
                membershipStatus: 'pending',
                createdAt: now,
                lastLogin: now,
                lastActive: now,
                avatarUrl: avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(name || 'User')}&background=B38B00&color=fff`,
                emailVerified: user.emailVerified || false,
                warnings: 0,
                // Membership features access
                hasBookingAccess: false,
                hasLoungeAccess: false,
                hasMentorshipAccess: false,
                hasLiveQAAccess: false,
                hasEarlyAccess: false,
                canVote: false
            });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Keyboard accessibility
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (loginModal.classList.contains('visible')) {
                    closeModal(loginModal);
                }
                if (signupModal.classList.contains('visible')) {
                    closeModal(signupModal);
                }
            }
        });

        // Form validation improvements
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('blur', validateInput);
            input.addEventListener('input', clearValidation);
        });

        function validateInput(e) {
            const input = e.target;
            const value = input.value.trim();

            input.classList.remove('invalid');

            if (!value && input.required) {
                input.classList.add('invalid');
                return;
            }

            if (input.type === 'email' && value && !isValidEmail(value)) {
                input.classList.add('invalid');
                return;
            }

            if (input.type === 'password' && value && value.length < 6) {
                input.classList.add('invalid');
                return;
            }
        }

        function clearValidation(e) {
            e.target.classList.remove('invalid');
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Add input validation styles
        const style = document.createElement('style');
        style.textContent = `
            .form-group input.invalid {
                border-color: var(--error-color);
                background-color: rgba(211, 47, 47, 0.05);
            }
            .form-group input.invalid:focus {
                box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
            }
        `;
        document.head.appendChild(style);

        // Handle plan selection
        function handlePlanSelection(selectedTier) {
            // Store the selected plan in localStorage
            localStorage.setItem('selectedPlan', selectedTier);
            
            // Check if user is logged in
            const auth = getAuth();
            const currentUser = auth.currentUser;

            if (currentUser) {
                // If logged in, redirect to charter page
                window.location.href = 'charter.html';
            } else {
                // If not logged in, redirect to login page with return URL
                window.location.href = `login.html?action=signup&redirect=charter&plan=${selectedTier}`;
            }
        }

        // Initialize Firebase Auth State Observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Update header buttons for logged-in state
                document.querySelector('.header-actions').innerHTML = `
                    <button onclick="window.location.href='home.html'" class="btn-secondary">Dashboard</button>
                    <button onclick="signOut(auth)" class="btn-primary">Sign Out</button>
                `;
            }
        });

        console.log('Andrew Cares Village - Optimized Landing Page Loaded Successfully');
    </script>

        <!-- 3. HTML: Footer -->
        <footer class="main-footer">
            <div class="footer-links">
                <a href="about.html">About Us</a>
                <a href="privacy.html">Privacy Policy</a>
                <a href="terms.html">Terms of Service</a>
            </div>
            <p>&copy; 2025 Andrew Cares Village. All Rights Reserved.</p>
        </footer>
        
        <!-- Hybrid AI Chat Widget Integration -->
        <script>
        // Hybrid AI Chat Widget - Smart AI + Fallback + Learning
        (function() {
            'use strict';
            
            class HybridAIChatWidget {
                constructor(options = {}) {
                    this.options = {
                        position: 'bottom-right',
                        primaryColor: '#6366f1',
                        secondaryColor: '#0f172a',
                        welcomeMessage: 'Hello! I\'m your AI assistant trained on Andrew Cares Village. Ask me anything about our platform!',
                        placeholder: 'Type your message...',
                        title: 'Andrew Cares Assistant',
                        chatbaseApiKey: options.chatbaseApiKey || null,
                        monthlyLimit: 20,
                        ...options
                    };
                    
                    this.isOpen = false;
                    this.messages = [];
                    this.isTyping = false;
                    this.smartAIUsage = this.getMonthlyUsage();
                    this.learningDatabase = this.loadLearningDatabase();
                    
                    this.init();
                }
                
                getMonthlyUsage() {
                    const currentMonth = new Date().getMonth() + '-' + new Date().getFullYear();
                    const stored = localStorage.getItem('aiUsage-' + currentMonth);
                    return stored ? parseInt(stored) : 0;
                }
                
                updateUsageCount() {
                    const currentMonth = new Date().getMonth() + '-' + new Date().getFullYear();
                    this.smartAIUsage++;
                    localStorage.setItem('aiUsage-' + currentMonth, this.smartAIUsage.toString());
                }
                
                loadLearningDatabase() {
                    const stored = localStorage.getItem('aiLearningDB');
                    return stored ? JSON.parse(stored) : {};
                }
                
                saveLearning(question, answer, source) {
                    const key = question.toLowerCase().trim();
                    this.learningDatabase[key] = {
                        answer: answer,
                        source: source,
                        timestamp: Date.now(),
                        useCount: (this.learningDatabase[key]?.useCount || 0) + 1
                    };
                    localStorage.setItem('aiLearningDB', JSON.stringify(this.learningDatabase));
                }
                
                getLearnedResponse(question) {
                    const key = question.toLowerCase().trim();
                    const learned = this.learningDatabase[key];
                    if (learned) {
                        learned.useCount++;
                        this.saveLearning(question, learned.answer, learned.source);
                        return learned.answer;
                    }
                    
                    for (const [learnedKey, data] of Object.entries(this.learningDatabase)) {
                        if (question.toLowerCase().includes(learnedKey) || learnedKey.includes(question.toLowerCase())) {
                            return data.answer;
                        }
                    }
                    
                    return null;
                }
                
                init() {
                    this.createWidget();
                    this.attachEventListeners();
                    this.addWelcomeMessage();
                }
                
                createWidget() {
                    this.widget = document.createElement('div');
                    this.widget.className = 'ai-chat-widget';
                    this.widget.innerHTML = this.getWidgetHTML();
                    
                    this.addStyles();
                    document.body.appendChild(this.widget);
                    
                    this.chatButton = this.widget.querySelector('.chat-toggle-btn');
                    this.chatWindow = this.widget.querySelector('.chat-window');
                    this.messagesContainer = this.widget.querySelector('.chat-messages');
                    this.messageInput = this.widget.querySelector('.message-input');
                    this.sendButton = this.widget.querySelector('.send-btn');
                    this.closeButton = this.widget.querySelector('.chat-close-btn');
                }
                
                getWidgetHTML() {
                    return `
                        <div class="chat-toggle-btn" title="Chat with AI Assistant">
                            <i class="fas fa-comments"></i>
                            <div class="notification-badge">1</div>
                        </div>
                        
                        <div class="chat-window">
                            <div class="chat-header">
                                <div class="chat-header-info">
                                    <div class="ai-avatar">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="chat-title">
                                        <h3>${this.options.title}</h3>
                                        <span class="status">Online</span>
                                    </div>
                                </div>
                                <button class="chat-close-btn" title="Close chat">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="chat-messages" id="chatMessages"></div>
                            
                            <div class="typing-indicator" style="display: none;">
                                <div class="typing-dots">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                                <span class="typing-text">AI is typing...</span>
                            </div>
                            
                            <div class="chat-input-container">
                                <div class="input-wrapper">
                                    <input 
                                        type="text" 
                                        class="message-input" 
                                        placeholder="${this.options.placeholder}"
                                        maxlength="500"
                                    >
                                    <button class="send-btn" title="Send message">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                                <div class="quick-actions">
                                    <button class="quick-btn" data-message="Tell me about Andrew Cares Village">About Us</button>
                                    <button class="quick-btn" data-message="How do I sign up for courses?">Sign Up Help</button>
                                    <button class="quick-btn" data-message="What mentorship options are available?">Mentorship</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                addStyles() {
                    const styles = `
                        .ai-chat-widget {
                            position: fixed;
                            right: 20px;
                            bottom: 20px;
                            z-index: 10000;
                            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                        }
                        
                        .chat-toggle-btn {
                            width: 60px;
                            height: 60px;
                            border-radius: 50%;
                            background: linear-gradient(135deg, ${this.options.primaryColor}, ${this.options.secondaryColor});
                            color: white;
                            border: none;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 24px;
                            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
                            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                            position: relative;
                            animation: pulse 2s infinite;
                        }
                        
                        @keyframes pulse {
                            0% { box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3); }
                            50% { box-shadow: 0 4px 25px rgba(99, 102, 241, 0.5); }
                            100% { box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3); }
                        }
                        
                        .chat-toggle-btn:hover {
                            transform: scale(1.1);
                            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
                        }
                        
                        .notification-badge {
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #ef4444;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            font-size: 12px;
                            font-weight: 600;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            animation: bounce 1s infinite;
                        }
                        
                        @keyframes bounce {
                            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                            40% { transform: translateY(-5px); }
                            60% { transform: translateY(-3px); }
                        }
                        
                        .chat-window {
                            position: absolute;
                            bottom: 80px;
                            right: 0;
                            width: 380px;
                            height: 500px;
                            background: white;
                            border-radius: 16px;
                            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
                            display: none;
                            flex-direction: column;
                            overflow: hidden;
                            transform: scale(0.8) translateY(20px);
                            opacity: 0;
                            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                            border: 1px solid rgba(0, 0, 0, 0.1);
                        }
                        
                        .chat-window.open {
                            display: flex;
                            transform: scale(1) translateY(0);
                            opacity: 1;
                        }
                        
                        .chat-header {
                            background: linear-gradient(135deg, ${this.options.primaryColor}, ${this.options.secondaryColor});
                            color: white;
                            padding: 16px 20px;
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                        }
                        
                        .chat-header-info {
                            display: flex;
                            align-items: center;
                            gap: 12px;
                        }
                        
                        .ai-avatar {
                            width: 40px;
                            height: 40px;
                            border-radius: 50%;
                            background: rgba(255, 255, 255, 0.2);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 18px;
                        }
                        
                        .chat-title h3 {
                            margin: 0;
                            font-size: 16px;
                            font-weight: 600;
                        }
                        
                        .status {
                            font-size: 12px;
                            opacity: 0.9;
                            display: flex;
                            align-items: center;
                            gap: 6px;
                        }
                        
                        .status::before {
                            content: '';
                            width: 8px;
                            height: 8px;
                            border-radius: 50%;
                            background: #10b981;
                            display: inline-block;
                        }
                        
                        .chat-close-btn {
                            background: none;
                            border: none;
                            color: white;
                            font-size: 18px;
                            cursor: pointer;
                            padding: 8px;
                            border-radius: 6px;
                            transition: background 0.2s;
                        }
                        
                        .chat-close-btn:hover {
                            background: rgba(255, 255, 255, 0.1);
                        }
                        
                        .chat-messages {
                            flex: 1;
                            overflow-y: auto;
                            padding: 20px;
                            background: #f8fafc;
                            display: flex;
                            flex-direction: column;
                            gap: 16px;
                        }
                        
                        .message {
                            max-width: 80%;
                            padding: 12px 16px;
                            border-radius: 18px;
                            font-size: 14px;
                            line-height: 1.4;
                            animation: slideIn 0.3s ease-out;
                        }
                        
                        @keyframes slideIn {
                            from {
                                opacity: 0;
                                transform: translateY(10px);
                            }
                            to {
                                opacity: 1;
                                transform: translateY(0);
                            }
                        }
                        
                        .message.user {
                            background: ${this.options.primaryColor};
                            color: white;
                            align-self: flex-end;
                            border-bottom-right-radius: 4px;
                        }
                        
                        .message.ai {
                            background: white;
                            color: #374151;
                            align-self: flex-start;
                            border-bottom-left-radius: 4px;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                        }
                        
                        .typing-indicator {
                            padding: 12px 20px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            background: #f8fafc;
                            border-top: 1px solid #e5e7eb;
                        }
                        
                        .typing-dots {
                            display: flex;
                            gap: 4px;
                        }
                        
                        .typing-dots span {
                            width: 6px;
                            height: 6px;
                            border-radius: 50%;
                            background: ${this.options.primaryColor};
                            animation: typingDot 1.4s infinite ease-in-out;
                        }
                        
                        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
                        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
                        
                        @keyframes typingDot {
                            0%, 80%, 100% {
                                transform: scale(0.8);
                                opacity: 0.5;
                            }
                            40% {
                                transform: scale(1);
                                opacity: 1;
                            }
                        }
                        
                        .typing-text {
                            font-size: 12px;
                            color: #6b7280;
                            font-style: italic;
                        }
                        
                        .chat-input-container {
                            padding: 16px 20px;
                            background: white;
                            border-top: 1px solid #e5e7eb;
                        }
                        
                        .input-wrapper {
                            display: flex;
                            gap: 8px;
                            margin-bottom: 12px;
                        }
                        
                        .message-input {
                            flex: 1;
                            padding: 12px 16px;
                            border: 2px solid #e5e7eb;
                            border-radius: 24px;
                            font-size: 14px;
                            outline: none;
                            transition: border-color 0.2s;
                            font-family: inherit;
                        }
                        
                        .message-input:focus {
                            border-color: ${this.options.primaryColor};
                        }
                        
                        .send-btn {
                            width: 44px;
                            height: 44px;
                            border-radius: 50%;
                            background: ${this.options.primaryColor};
                            color: white;
                            border: none;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            transition: all 0.2s;
                            font-size: 16px;
                        }
                        
                        .send-btn:hover {
                            background: ${this.options.secondaryColor};
                            transform: scale(1.05);
                        }
                        
                        .send-btn:disabled {
                            background: #d1d5db;
                            cursor: not-allowed;
                            transform: none;
                        }
                        
                        .quick-actions {
                            display: flex;
                            gap: 8px;
                            flex-wrap: wrap;
                        }
                        
                        .quick-btn {
                            padding: 6px 12px;
                            background: #f3f4f6;
                            border: 1px solid #e5e7eb;
                            border-radius: 16px;
                            font-size: 12px;
                            cursor: pointer;
                            transition: all 0.2s;
                            color: #374151;
                        }
                        
                        .quick-btn:hover {
                            background: ${this.options.primaryColor};
                            color: white;
                            border-color: ${this.options.primaryColor};
                        }
                        
                        @media (max-width: 480px) {
                            .chat-window {
                                width: calc(100vw - 40px);
                                height: calc(100vh - 100px);
                                right: 20px;
                                bottom: 80px;
                            }
                        }
                        
                        .chat-messages::-webkit-scrollbar {
                            width: 4px;
                        }
                        
                        .chat-messages::-webkit-scrollbar-track {
                            background: transparent;
                        }
                        
                        .chat-messages::-webkit-scrollbar-thumb {
                            background: #d1d5db;
                            border-radius: 2px;
                        }
                    `;
                    
                    const styleSheet = document.createElement('style');
                    styleSheet.textContent = styles;
                    document.head.appendChild(styleSheet);
                }
                
                attachEventListeners() {
                    this.chatButton.addEventListener('click', () => this.toggleChat());
                    this.closeButton.addEventListener('click', () => this.closeChat());
                    
                    this.sendButton.addEventListener('click', () => this.sendMessage());
                    this.messageInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.sendMessage();
                        }
                    });
                    
                    this.widget.addEventListener('click', (e) => {
                        if (e.target.classList.contains('quick-btn')) {
                            const message = e.target.getAttribute('data-message');
                            this.messageInput.value = message;
                            this.sendMessage();
                        }
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (!this.widget.contains(e.target) && this.isOpen) {
                            this.closeChat();
                        }
                    });
                }
                
                toggleChat() {
                    if (this.isOpen) {
                        this.closeChat();
                    } else {
                        this.openChat();
                    }
                }
                
                openChat() {
                    this.isOpen = true;
                    this.chatWindow.classList.add('open');
                    this.hideNotificationBadge();
                    this.messageInput.focus();
                }
                
                closeChat() {
                    this.isOpen = false;
                    this.chatWindow.classList.remove('open');
                }
                
                addWelcomeMessage() {
                    this.addMessage(this.options.welcomeMessage, 'ai');
                }
                
                sendMessage() {
                    const message = this.messageInput.value.trim();
                    if (!message) return;
                    
                    this.addMessage(message, 'user');
                    this.messageInput.value = '';
                    
                    this.showTyping();
                    this.processAIResponse(message);
                }
                
                addMessage(content, sender) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${sender}`;
                    messageDiv.textContent = content;
                    
                    this.messagesContainer.appendChild(messageDiv);
                    this.scrollToBottom();
                    
                    this.messages.push({ content, sender, timestamp: Date.now() });
                }
                
                showTyping() {
                    this.isTyping = true;
                    this.widget.querySelector('.typing-indicator').style.display = 'flex';
                    this.scrollToBottom();
                }
                
                hideTyping() {
                    this.isTyping = false;
                    this.widget.querySelector('.typing-indicator').style.display = 'none';
                }
                
                async processAIResponse(userMessage) {
                    try {
                        this.showTyping();
                        let response;
                        let source;
                        
                        // 1. Check learned responses first
                        const learnedResponse = this.getLearnedResponse(userMessage);
                        if (learnedResponse) {
                            response = learnedResponse;
                            source = 'learned';
                        }
                        // 2. Try smart AI if under limit and API key available
                        else if (this.smartAIUsage < this.options.monthlyLimit && this.options.chatbaseApiKey) {
                            try {
                                response = await this.callSmartAI(userMessage);
                                source = 'smart';
                                this.updateUsageCount();
                                this.saveLearning(userMessage, response, 'smart');
                            } catch (error) {
                                console.warn('Smart AI failed, using fallback:', error);
                                response = this.getBuiltInResponse(userMessage);
                                source = 'fallback';
                            }
                        }
                        // 3. Use fallback AI
                        else {
                            response = this.getBuiltInResponse(userMessage);
                            source = 'fallback';
                        }
                        
                        await this.delay(500);
                        this.hideTyping();
                        this.addMessage(response, 'ai');
                        this.addUsageIndicator(source);
                        
                    } catch (error) {
                        console.error('AI Response Error:', error);
                        this.hideTyping();
                        this.addMessage('I apologize, but I\'m having trouble processing your request right now. Please try again later or contact our support team.', 'ai');
                    }
                }
                
                async callSmartAI(message) {
                    // Support multiple AI providers
                    if (this.options.openaiApiKey) {
                        return await this.callOpenAI(message);
                    } else if (this.options.chatbaseApiKey) {
                        return await this.callChatbase(message);
                    } else {
                        throw new Error('No API key configured');
                    }
                }
                
                async callOpenAI(message) {
                    const systemPrompt = `You are an AI assistant for Andrew Cares Village, a completely FREE learning platform. Key facts:
                    - All courses and platform features are 100% free
                    - Mentorship marketplace where mentors set their own rates
                    - 10% commission on mentorship to maintain platform
                    - Voluntary donations support the platform
                    - No subscription fees or hidden costs
                    Answer questions about courses, mentorship, pricing, and platform features.`;
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.options.openaiApiKey}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                { role: 'system', content: systemPrompt },
                                { role: 'user', content: message }
                            ],
                            max_tokens: 200,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`OpenAI API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0]?.message?.content || 'I couldn\'t generate a response.';
                }
                
                async callChatbase(message) {
                    const response = await fetch('https://www.chatbase.co/api/v1/chat', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.options.chatbaseApiKey}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            conversation_id: this.getConversationId(),
                            model: 'gpt-3.5-turbo'
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.response || data.message || 'I couldn\'t generate a response.';
                }
                
                getConversationId() {
                    let id = localStorage.getItem('conversationId');
                    if (!id) {
                        id = 'conv_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        localStorage.setItem('conversationId', id);
                    }
                    return id;
                }
                
                addUsageIndicator(source) {
                    const indicator = document.createElement('div');
                    indicator.className = 'usage-indicator';
                    indicator.style.cssText = 'text-align: right; margin-top: 5px; opacity: 0.7;';
                    indicator.innerHTML = `
                        <small style="color: #6b7280; font-size: 11px;">
                            ${source === 'smart' ? ` Smart AI (${this.smartAIUsage}/${this.options.monthlyLimit})` : 
                              source === 'learned' ? ' Learned Response' : ' Fallback AI'}
                        </small>
                    `;
                    this.messagesContainer.appendChild(indicator);
                    this.scrollToBottom();
                }
                
                getBuiltInResponse(message) {
                    const lowerMessage = message.toLowerCase();
                    
                    // Platform Overview & Mission
                    if (lowerMessage.includes('about') || lowerMessage.includes('what is') || lowerMessage.includes('mission')) {
                        return 'Andrew Cares Village is a completely FREE learning and community platform dedicated to empowering individuals through education, mentorship connections, and personal development. Our mission is to provide accessible education and create meaningful connections between learners and mentors. Everything on our platform is free - we operate on voluntary donations and serve as a marketplace connecting mentors with students.';
                    }
                    
                    // Free Access & Registration
                    if (lowerMessage.includes('sign up') || lowerMessage.includes('register') || lowerMessage.includes('join') || lowerMessage.includes('account')) {
                        return 'Joining Andrew Cares Village is completely FREE! Click "Sign Up" in the navigation to create your account. Once registered, you get immediate access to: Village Square (community hub), The Dojo (training resources), Village Library (free resources), messaging system, live events, and the ability to connect with mentors. No membership fees or tiers - everything is free!';
                    }
                    
                    // Free Resources & Learning
                    if (lowerMessage.includes('course') || lowerMessage.includes('learn') || lowerMessage.includes('class') || lowerMessage.includes('resource') || lowerMessage.includes('library') || lowerMessage.includes('dojo') || lowerMessage.includes('training')) {
                        return 'All learning resources on Andrew Cares Village are completely FREE! Visit "The Village Library" for free educational resources, articles, and materials. Check out "The Dojo" for training content and skill development. We also host free live events and community discussions. No payments required - just sign up and start learning!';
                    }
                    
                    // Mentorship Marketplace
                    if (lowerMessage.includes('mentor') || lowerMessage.includes('guidance') || lowerMessage.includes('advice') || lowerMessage.includes('1-on-1') || lowerMessage.includes('personal')) {
                        return 'Our mentorship system works as a marketplace connecting students with mentors. While our platform and community resources are FREE, individual mentors set their own rates for personalized 1-on-1 sessions. The platform takes a 10% commission from each mentorship transaction to help maintain and improve our services. Browse available mentors, view their profiles, rates, and specialties, then book sessions directly with them.';
                    }
                    
                    // Becoming an Instructor/Mentor
                    if (lowerMessage.includes('instructor') || lowerMessage.includes('teach') || lowerMessage.includes('become') || lowerMessage.includes('apply') || lowerMessage.includes('join as') || lowerMessage.includes('earn')) {
                        return 'Anyone with sufficient experience can become an instructor or mentor on Andrew Cares Village! Requirements include demonstrated expertise in your field, professional/educational background, and ability to teach effectively. Complete our instructor application form, provide credentials and portfolio, then undergo our review process. Once approved, you can set your own rates, manage your schedule, earn income sharing knowledge, and join our community of educators. Visit our instructor application page to get started!';
                    }
                    
                    // Pricing & Business Model
                    if (lowerMessage.includes('price') || lowerMessage.includes('cost') || lowerMessage.includes('fee') || lowerMessage.includes('payment') || lowerMessage.includes('free') || lowerMessage.includes('money')) {
                        return 'Andrew Cares Village is 100% FREE to use! All platform features, resources, community access, and learning materials are completely free. The only costs are optional: 1) Voluntary donations to support the platform, and 2) Individual mentor sessions (mentors set their own rates, with a 10% platform commission to maintain our services). This commission helps us keep all other features free for everyone.';
                    }
                    
                    // Donations & Support
                    if (lowerMessage.includes('donate') || lowerMessage.includes('donation') || lowerMessage.includes('contribute') || lowerMessage.includes('support platform')) {
                        return 'Thank you for considering supporting Andrew Cares Village! Donations are completely voluntary and help us maintain this free platform for everyone. Visit our Donate page to contribute any amount you\'re comfortable with. Every donation helps us keep the platform running, improve features, and maintain our mission of free education for all. Your support makes a real difference in our community!';
                    }
                    
                    // Platform Features
                    if (lowerMessage.includes('feature') || lowerMessage.includes('village square') || lowerMessage.includes('community') || lowerMessage.includes('message') || lowerMessage.includes('chat')) {
                        return 'Andrew Cares Village offers many FREE features: Village Square (community hub and dashboard), The Dojo (training resources), Village Library (educational materials), messaging system for community interaction, live events and Q&A sessions, mentor marketplace, user profiles, and this AI assistant! All features are included with your free account.';
                    }
                    
                    // Live Events & Community
                    if (lowerMessage.includes('event') || lowerMessage.includes('live') || lowerMessage.includes('webinar') || lowerMessage.includes('session') || lowerMessage.includes('community')) {
                        return 'We host regular FREE live events including educational webinars, community Q&A sessions, skill-building workshops, and networking opportunities. Check the Live Events section in your dashboard to see upcoming events and join our active community discussions. All events are free to attend for registered members!';
                    }
                    
                    // Technical Support
                    if (lowerMessage.includes('contact') || lowerMessage.includes('support') || lowerMessage.includes('help') || lowerMessage.includes('problem') || lowerMessage.includes('issue')) {
                        return 'For support, you can: 1) Use this AI chat for immediate help, 2) Visit our Contact page to send a message, 3) Use the community messaging system to connect with other members, or 4) Join our live Q&A events. We typically respond within 24 hours and our community is always ready to help fellow members!';
                    }
                    
                    // Navigation & Getting Started
                    if (lowerMessage.includes('navigate') || lowerMessage.includes('start') || lowerMessage.includes('begin') || lowerMessage.includes('how to') || lowerMessage.includes('getting started')) {
                        return 'Getting started is easy! After signing up for free: 1) Visit Village Square (your main dashboard), 2) Explore The Village Library for free resources, 3) Check out The Dojo for training materials, 4) Browse available mentors if you want personalized guidance, 5) Join live events, and 6) Connect with the community through messaging. Everything is designed to be intuitive and user-friendly!';
                    }
                    
                    // Greetings
                    if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                        return 'Hello! Welcome to Andrew Cares Village - your completely FREE learning and community platform! I\'m here to help you navigate our features, answer questions about our free resources, mentorship marketplace, or anything else. What would you like to know about our platform?';
                    }
                    
                    // Thanks
                    if (lowerMessage.includes('thank')) {
                        return 'You\'re very welcome! I\'m happy to help you make the most of Andrew Cares Village. Remember, everything here is free - explore our resources, connect with the community, and don\'t hesitate to ask if you need anything else!';
                    }
                    
                    // Commission & Revenue Model
                    if (lowerMessage.includes('commission') || lowerMessage.includes('revenue') || lowerMessage.includes('how do you make money') || lowerMessage.includes('business model')) {
                        return 'Andrew Cares Village operates on a sustainable model: all platform features are completely FREE for users. We generate revenue through: 1) A 10% commission on mentorship transactions (this helps maintain our services), and 2) Voluntary donations from our community. This allows us to keep all learning resources, community features, and platform access completely free while ensuring quality service.';
                    }
                    
                    // Default response with comprehensive info
                    return 'I understand you\'re asking about "' + message + '". Andrew Cares Village is a FREE platform offering: community access (Village Square), learning resources (Village Library), training materials (The Dojo), mentorship connections, live events, and messaging. Mentorship sessions have individual costs set by mentors (with a 10% platform commission). Feel free to ask about any specific feature, or contact our support team for detailed assistance!';
                }
                
                scrollToBottom() {
                    setTimeout(() => {
                        this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                    }, 100);
                }
                
                hideNotificationBadge() {
                    const badge = this.widget.querySelector('.notification-badge');
                    if (badge) {
                        badge.style.display = 'none';
                    }
                }
                
                delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
            }
            
            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    window.aiChatWidget = new HybridAIChatWidget({
                        // To enable Smart AI, add your Chatbase API key:
                        // chatbaseApiKey: 'your-chatbase-api-key-here'
                    });
                });
            } else {
                window.aiChatWidget = new HybridAIChatWidget({
                    // FREE ALTERNATIVES (no API key needed):
                    // Option 1: Use built-in AI (unlimited, works now)
                    // Option 2: Add Tidio widget for free chat
                    // Option 3: Use OpenAI API with your own key ($5 credit free)
                    useBuiltInAI: true
                });
            }
            
            // Setup instructions logged to console
            console.log(' Hybrid AI Chat System Active!');
            console.log(' FREE AI Setup Options:');
            console.log('Option 1: OpenAI API - Get $5 free credit at platform.openai.com');
            console.log('   Add: openaiApiKey: "sk-your-key" to configuration');
            console.log('Option 2: Current system works unlimited with built-in AI');
            console.log('Option 3: Add external chat widgets (Tidio, Crisp) for free');
            console.log(' Your chat is working now - test it in bottom-right corner!');
            
        })();
        </script>
        
        <!-- Hybrid AI Chat Widget -->
        <script src="js/advanced-hybrid-chat.js"></script>
    </body>

</html>